version: '3.8'

services:
  cache:
    container_name: redis-cache
    image: redis:alpine
    ports:
      - 6379:6379
    command: redis-server --save 20 1 --requirepass "lfjdop23oipfghdsa"
    volumes:
      - .docker/redis-data:/data
    networks:
      - ratelimiter
  goapp:
    build: .
    container_name: ratelimiter-go
    ports:
      - 8080:8080
    networks:
      - ratelimiter
    environment:
      - APP_ENV=production
    depends_on:
      - cache
  k6-test:
    container_name: k6-test
    image: grafana/k6
    volumes:
      - ./docs/k6:/scripts
    command: run --out json=/scripts/results.json /scripts/script.js 
    networks:
      - ratelimiter
    depends_on:
      - goapp

networks:
  ratelimiter:
    